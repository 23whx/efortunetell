# ğŸ—ï¸ æ˜“ç»é¢„æµ‹åšå®¢ç³»ç»Ÿæ¶æ„è¯´æ˜ä¹¦

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºå‰åç«¯åˆ†ç¦»çš„æ˜“ç»é¢„æµ‹åšå®¢ç³»ç»Ÿï¼Œé‡‡ç”¨ç°ä»£åŒ–çš„äº‘åŸç”Ÿæ¶æ„ã€‚

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
- æ˜“ç»é¢„æµ‹æœåŠ¡
- åšå®¢æ–‡ç« ç®¡ç†
- ç”¨æˆ·è®¤è¯ä¸ç®¡ç†
- é¢„çº¦æœåŠ¡ç³»ç»Ÿ
- ç®¡ç†åå°

## ğŸŒ ç³»ç»Ÿæ¶æ„å›¾

```
ç”¨æˆ·æµè§ˆå™¨
    â†“ HTTPS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Cloudflare CDN                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ www.efortunetell â”‚              â”‚ api.efortunetell    â”‚   â”‚
â”‚  â”‚ .blog           â”‚              â”‚ .blog               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ ç›´è¿                                 â”‚ ä»£ç†
         â”‚ (ä»…DNS)                              â”‚ (æ©™äº‘)
         â†“                                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Vercel      â”‚                   â”‚    VPS Server       â”‚
â”‚   (å‰ç«¯æ‰˜ç®¡)     â”‚                   â”‚ (172.245.144.253)   â”‚
â”‚                 â”‚                   â”‚                     â”‚
â”‚  Next.js åº”ç”¨   â”‚                   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  - åšå®¢é¡µé¢     â”‚                   â”‚  â”‚    Nginx      â”‚  â”‚
â”‚  - ç”¨æˆ·ç•Œé¢     â”‚                   â”‚  â”‚ (åå‘ä»£ç†+SSL) â”‚  â”‚
â”‚  - ç®¡ç†åå°     â”‚                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                 â”‚                   â”‚         â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚         â†“           â”‚
                                      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                                      â”‚  â”‚ Docker Composeâ”‚  â”‚
                                      â”‚  â”‚               â”‚  â”‚
                                      â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
                                      â”‚  â”‚ â”‚  Node.js  â”‚ â”‚  â”‚
                                      â”‚  â”‚ â”‚  Express  â”‚ â”‚  â”‚
                                      â”‚  â”‚ â”‚    API    â”‚ â”‚  â”‚
                                      â”‚  â”‚ â”‚ :5000     â”‚ â”‚  â”‚
                                      â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
                                      â”‚  â”‚               â”‚  â”‚
                                      â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
                                      â”‚  â”‚ â”‚ MongoDB   â”‚ â”‚  â”‚
                                      â”‚  â”‚ â”‚ Database  â”‚ â”‚  â”‚
                                      â”‚  â”‚ â”‚ :27017    â”‚ â”‚  â”‚
                                      â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
                                      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æŠ€æœ¯æ ˆè¯¦ç»†è¯´æ˜

### å‰ç«¯ (E-Front-end)
- **æ¡†æ¶**: Next.js 14 (React 18)
- **è¯­è¨€**: TypeScript
- **æ ·å¼**: TailwindCSS
- **éƒ¨ç½²å¹³å°**: Vercel
- **åŸŸå**: www.efortunetell.blog
- **CDN**: é€šè¿‡Cloudflare (ä»…DNSæ¨¡å¼)

#### å…³é”®é…ç½®æ–‡ä»¶
```bash
E-Front-end/
â”œâ”€â”€ next.config.mjs     # Next.jsé…ç½®ï¼ŒAPIä»£ç†è®¾ç½®
â”œâ”€â”€ vercel.json         # Verceléƒ¨ç½²é…ç½®
â”œâ”€â”€ src/config/api.ts   # APIåŸºç¡€URLé…ç½®
â””â”€â”€ src/app/            # é¡µé¢å’Œè·¯ç”±
```

### åç«¯ (E-Backend-Project)
- **æ¡†æ¶**: Express.js (Node.js)
- **æ•°æ®åº“**: MongoDB
- **è®¤è¯**: JWT + bcrypt
- **æ–‡ä»¶ä¸Šä¼ **: æ”¯æŒå›¾ç‰‡ä¸Šä¼ åˆ°æœ¬åœ°å­˜å‚¨
- **éƒ¨ç½²**: Docker + Docker Compose
- **æœåŠ¡å™¨**: VPS (Ubuntu)
- **åŸŸå**: api.efortunetell.blog

#### å…³é”®é…ç½®æ–‡ä»¶
```bash
E-Backend-Project/
â”œâ”€â”€ docker-compose.prod.yml    # ç”Ÿäº§ç¯å¢ƒDockeré…ç½®
â”œâ”€â”€ src/app.js                 # Expressåº”ç”¨å…¥å£
â”œâ”€â”€ src/config/                # æ•°æ®åº“ã€CORSç­‰é…ç½®
â”œâ”€â”€ src/routes/                # APIè·¯ç”±å®šä¹‰
â”œâ”€â”€ src/controllers/           # ä¸šåŠ¡é€»è¾‘æ§åˆ¶å™¨
â”œâ”€â”€ src/models/                # MongoDBæ•°æ®æ¨¡å‹
â””â”€â”€ public/images/             # æ–‡ç« å›¾ç‰‡å­˜å‚¨ç›®å½•
```

## ğŸŒ åŸŸåä¸DNSé…ç½®

### Cloudflare DNSè®°å½•
```
ç±»å‹    åç§°                    å†…å®¹                      ä»£ç†çŠ¶æ€
A       @                      172.245.144.253           ğŸŸ  å·²ä»£ç†
A       api                    172.245.144.253           ğŸŸ  å·²ä»£ç†  
CNAME   www                    cname.vercel-dns.com      ğŸ”˜ ä»…DNS
CAA     efortunetell.blog      0 issue letsencrypt.org   ğŸ”˜ ä»…DNS
NS      efortunetell.blog      ns1.vercel-dns.com        ğŸ”˜ ä»…DNS
NS      efortunetell.blog      ns2.vercel-dns.com        ğŸ”˜ ä»…DNS
```

### åŸŸåè®¿é—®æµç¨‹
1. **www.efortunetell.blog** â†’ ç›´è¿Vercel â†’ å‰ç«¯åº”ç”¨
2. **efortunetell.blog** â†’ Cloudflare â†’ VPS â†’ 301é‡å®šå‘åˆ°www
3. **api.efortunetell.blog** â†’ Cloudflare â†’ VPS â†’ Nginx â†’ Express API

## ğŸ”’ SSL/TLSé…ç½®

### Cloudflareè®¾ç½®
- **SSLæ¨¡å¼**: Full (Strict) 
- **åŠ å¯†**: ç«¯åˆ°ç«¯HTTPSåŠ å¯†
- **è¯ä¹¦**: Cloudflareé€šç”¨SSLè¯ä¹¦

### VPS SSLé…ç½®
- **è¯ä¹¦æä¾›å•†**: Let's Encrypt
- **åŸŸåè¦†ç›–**: api.efortunetell.blog, efortunetell.blog
- **è‡ªåŠ¨ç»­æœŸ**: é€šè¿‡crontabè®¾ç½®
- **Nginxé…ç½®**: ç›‘å¬443ç«¯å£ï¼ŒSSLç»ˆæ­¢

## ğŸ“¦ éƒ¨ç½²é…ç½®

### å‰ç«¯éƒ¨ç½² (Vercel)
```json
// vercel.json
{
  "redirects": [
    {
      "source": "/api/:path*",
      "destination": "https://api.efortunetell.blog/api/:path*"
    }
  ],
  "rewrites": [
    {
      "source": "/images/:path*", 
      "destination": "https://api.efortunetell.blog/images/:path*"
    }
  ]
}
```

### åç«¯éƒ¨ç½² (Docker)
```yaml
# docker-compose.prod.yml
version: '3.8'
services:
  yi-backend-prod:
    build: .
    ports:
      - "5000:5000"
    environment:
      - NODE_ENV=production
    depends_on:
      - yi-mongodb-prod
      
  yi-mongodb-prod:
    image: mongo:7.0
    ports:
      - "27017:27017"
    volumes:
      - mongodb_data:/data/db
```

### Nginxåå‘ä»£ç†é…ç½®
```nginx
# /etc/nginx/sites-available/production

# æ ¹åŸŸåé‡å®šå‘
server {
    listen 443 ssl;
    server_name efortunetell.blog;
    ssl_certificate /etc/letsencrypt/live/api.efortunetell.blog/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/api.efortunetell.blog/privkey.pem;
    return 301 https://www.efortunetell.blog$request_uri;
}

# APIæœåŠ¡å™¨
server {
    listen 443 ssl;
    server_name api.efortunetell.blog;
    ssl_certificate /etc/letsencrypt/live/api.efortunetell.blog/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/api.efortunetell.blog/privkey.pem;
    
    location / {
        proxy_pass http://localhost:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

## ğŸ”„ æ•°æ®æµè¯¦è§£

### 1. å‰ç«¯é¡µé¢è®¿é—®
```
ç”¨æˆ·è®¿é—® www.efortunetell.blog
    â†“
Cloudflare DNSè§£æ (ä»…DNSæ¨¡å¼)
    â†“
ç›´è¿VercelæœåŠ¡å™¨
    â†“
è¿”å›Next.jsæ¸²æŸ“çš„é¡µé¢
```

### 2. APIè°ƒç”¨æµç¨‹
```
å‰ç«¯å‘èµ·APIè¯·æ±‚ (/api/*)
    â†“
Next.js rewritesè§„åˆ™
    â†“
é‡å†™ä¸º https://api.efortunetell.blog/api/*
    â†“
Cloudflare CDN (æ©™äº‘ä»£ç†)
    â†“
VPS Nginxåå‘ä»£ç†
    â†“
Dockerå®¹å™¨ä¸­çš„Expressåº”ç”¨
    â†“
MongoDBæ•°æ®åº“æ“ä½œ
    â†“
è¿”å›JSONå“åº”
```

### 3. å›¾ç‰‡èµ„æºè®¿é—®
```
å‰ç«¯è¯·æ±‚å›¾ç‰‡ (/images/*)
    â†“
Next.js rewritesè§„åˆ™
    â†“
é‡å†™ä¸º https://api.efortunetell.blog/images/*
    â†“
Cloudflare CDNç¼“å­˜
    â†“
VPSé™æ€æ–‡ä»¶æœåŠ¡
    â†“
è¿”å›å›¾ç‰‡æ–‡ä»¶
```

## ğŸ› ï¸ ç¯å¢ƒå˜é‡é…ç½®

### å‰ç«¯ç¯å¢ƒå˜é‡
```bash
# .env.local (å¯é€‰ï¼Œæœ‰é»˜è®¤å€¼)
NEXT_PUBLIC_API_URL=https://api.efortunetell.blog
NEXT_PUBLIC_ENVIRONMENT=production
```

### åç«¯ç¯å¢ƒå˜é‡
```bash
# .env (VPSä¸Šå¿…éœ€)
NODE_ENV=production
PORT=5000
MONGODB_URI=mongodb://username:password@mongodb:27017/yi-divination?authSource=admin
JWT_SECRET=your_64_character_random_jwt_secret
SESSION_SECRET=your_64_character_random_session_secret
CORS_ORIGIN=https://www.efortunetell.blog
BCRYPT_ROUNDS=12
```

## ğŸ” ç›‘æ§ä¸ç»´æŠ¤

### å¥åº·æ£€æŸ¥ç«¯ç‚¹
- **åç«¯API**: `https://api.efortunetell.blog/api/ping`
- **é¢„æœŸå“åº”**: `{"success":true,"message":"pong","timestamp":"..."}`

### æ—¥å¿—ä½ç½®
```bash
# VPSä¸Šçš„æ—¥å¿—ä½ç½®
/home/yiuser/E-Backend-Project/
â”œâ”€â”€ docker logs yi-backend-prod     # åç«¯åº”ç”¨æ—¥å¿—
â”œâ”€â”€ docker logs yi-mongodb-prod     # æ•°æ®åº“æ—¥å¿—
â””â”€â”€ /var/log/nginx/                  # Nginxè®¿é—®å’Œé”™è¯¯æ—¥å¿—
```

### SSLè¯ä¹¦è‡ªåŠ¨ç»­æœŸ
```bash
# crontabè®¾ç½®
0 12 * * * /usr/bin/certbot renew --quiet
```

## ğŸš¨ æ•…éšœæ’æŸ¥æŒ‡å—

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. å‰ç«¯æ— æ³•è®¿é—®
- æ£€æŸ¥Verceléƒ¨ç½²çŠ¶æ€
- ç¡®è®¤DNSè®°å½•ä¸­wwwæŒ‡å‘cname.vercel-dns.com
- æ£€æŸ¥Cloudflareä»£ç†çŠ¶æ€ï¼ˆåº”ä¸ºç°äº‘ï¼‰

#### 2. APIè°ƒç”¨å¤±è´¥
- æ£€æŸ¥VPSä¸ŠDockerå®¹å™¨çŠ¶æ€ï¼š`docker ps`
- æ£€æŸ¥Nginxé…ç½®ï¼š`sudo nginx -t`
- æ£€æŸ¥SSLè¯ä¹¦æœ‰æ•ˆæ€§ï¼š`curl -I https://api.efortunetell.blog/api/ping`

#### 3. é‡å®šå‘å¾ªç¯
- ç¡®è®¤efortunetell.blogåœ¨Cloudflareä¸­æŒ‡å‘VPSï¼ˆæ©™äº‘ï¼‰
- ç¡®è®¤efortunetell.blogä¸åœ¨VercelåŸŸåé…ç½®ä¸­
- æ£€æŸ¥Nginxé‡å®šå‘é…ç½®

#### 4. å›¾ç‰‡åŠ è½½å¤±è´¥
- ç¡®è®¤å›¾ç‰‡å­˜åœ¨äºVPSçš„/home/yiuser/E-Backend-Project/public/images/
- æ£€æŸ¥Nginxé™æ€æ–‡ä»¶æœåŠ¡é…ç½®
- éªŒè¯Next.jsçš„rewritesè§„åˆ™

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### CDNç¼“å­˜ç­–ç•¥
- é™æ€èµ„æºé€šè¿‡Cloudflare CDNç¼“å­˜
- APIå“åº”è®¾ç½®åˆé€‚çš„Cache-Controlå¤´

### æ•°æ®åº“ä¼˜åŒ–
- MongoDBç´¢å¼•ä¼˜åŒ–
- å®šæœŸå¤‡ä»½æ•°æ®åº“

### å®‰å…¨æªæ–½
- JWTä»¤ç‰Œå®šæœŸè½®æ¢
- APIé€Ÿç‡é™åˆ¶
- CORSç­–ç•¥ä¸¥æ ¼æ§åˆ¶
- HTTPSå¼ºåˆ¶ä½¿ç”¨

## ğŸ”„ æ›´æ–°éƒ¨ç½²æµç¨‹

### å‰ç«¯æ›´æ–°
```bash
# æœ¬åœ°å¼€å‘ç¯å¢ƒ
cd E-Front-end
git add .
git commit -m "feat: æ›´æ–°å†…å®¹"
git push origin main
# Vercelè‡ªåŠ¨éƒ¨ç½²ï¼Œçº¦1-2åˆ†é’Ÿå®Œæˆ
```

### åç«¯æ›´æ–°
```bash
# VPSä¸Šæ›´æ–°
ssh yiuser@172.245.144.253
cd /home/yiuser/E-Backend-Project
git pull origin main
sudo docker-compose -f docker-compose.prod.yml down
sudo docker-compose -f docker-compose.prod.yml up -d --build
```

## ğŸ“ è”ç³»ä¿¡æ¯

### æœåŠ¡å™¨è®¿é—®
- **VPS IP**: 172.245.144.253
- **SSHç”¨æˆ·**: yiuser
- **é¡¹ç›®è·¯å¾„**: /home/yiuser/E-Backend-Project

### åŸŸåç®¡ç†
- **åŸŸåæ³¨å†Œå•†**: [å¡«å†™ä½ çš„åŸŸåæ³¨å†Œå•†]
- **DNSç®¡ç†**: Cloudflare
- **SSLè¯ä¹¦**: Let's Encrypt (è‡ªåŠ¨ç»­æœŸ)

---

## ğŸ¤– AIåŠ©æ‰‹ä½¿ç”¨è¯´æ˜

å½“ä½ éœ€è¦AIååŠ©æ’æŸ¥é—®é¢˜æ—¶ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **å…·ä½“é”™è¯¯ä¿¡æ¯**ï¼šå®Œæ•´çš„é”™è¯¯æ—¥å¿—æˆ–é”™è¯¯æ¶ˆæ¯
2. **é—®é¢˜å‘ç”Ÿçš„ç¯èŠ‚**ï¼šå‰ç«¯ã€åç«¯ã€è¿˜æ˜¯åŸŸåè®¿é—®
3. **æœ€è¿‘çš„ä¿®æ”¹**ï¼šæ˜¯å¦æœ‰ä»£ç æ›´æ–°æˆ–é…ç½®å˜æ›´
4. **å½“å‰çŠ¶æ€**ï¼šå„æœåŠ¡çš„è¿è¡ŒçŠ¶æ€

AIå¯ä»¥æ ¹æ®æ­¤æ¶æ„è¯´æ˜ä¹¦å¿«é€Ÿç†è§£ç³»ç»Ÿç»“æ„ï¼Œæä¾›å‡†ç¡®çš„æ•…éšœæ’æŸ¥å»ºè®®ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025å¹´6æœˆ18æ—¥  
**ç»´æŠ¤è€…**: ç³»ç»Ÿç®¡ç†å‘˜ 